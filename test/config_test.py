# config.py
"""
âš™ï¸ ì „ì—­ ì„¤ì • íŒŒì¼
- ì‹¤ì „/ëª¨ì˜ ì „í™˜
- API í‚¤ / ì„œë²„
- ë§¤ìˆ˜ ì‹œê°„ í•„í„°
- ì†ì ˆ / íŠ¸ë ˆì¼ë§ íŒŒë¼ë¯¸í„°
- ë¦¬ìŠ¤í¬ ê´€ë¦¬ (MDD ë“±)
"""

# =====================================================
# ğŸ” ì‹¤ì „ / ëª¨ì˜íˆ¬ì ì „í™˜
# =====================================================
# âš ï¸ ì‹¤ì „ìœ¼ë¡œ ë°”ê¿€ ë•Œë§Œ False
is_paper_trading = True

# =====================================================
# ğŸŒ± í™˜ê²½ ì‹ë³„ (ë¡œê·¸/í‘œì‹œìš©)
# =====================================================
ENV_NAME = "TEST"


# =====================================================
# ğŸ” API KEY (ë”°ì˜´í‘œ í•„ìˆ˜)
# =====================================================
# ì‹¤ì „
real_app_key = "(ì‹¤ì „ APP KEY)"
real_app_secret = "(ì‹¤ì „ APP SECRET)"

# ëª¨ì˜
paper_app_key = "-ty84nqoUT_lqsCDBdzWDwlXhY2GD3gSVTISF634OG0"
paper_app_secret = "AQcFnDAqDisMozC8zjilrBnJBFpnRRgljTxgxmAFucM"


# =====================================================
# ğŸŒ API / SOCKET URL
# =====================================================
real_host_url = "https://api.kiwoom.com"
paper_host_url = "https://mockapi.kiwoom.com"

real_socket_url = "wss://api.kiwoom.com:10000"
paper_socket_url = "wss://mockapi.kiwoom.com:10000"

# ì„ íƒëœ í™˜ê²½
app_key = paper_app_key if is_paper_trading else real_app_key
app_secret = paper_app_secret if is_paper_trading else real_app_secret
host_url = paper_host_url if is_paper_trading else real_host_url
socket_url = paper_socket_url if is_paper_trading else real_socket_url


# =====================================================
# ğŸ’° ì˜ˆìˆ˜ê¸ˆ ì„¤ì • (ì‹¤ì „ / ëª¨ì˜ ê³µí†µ ì œì–´)
# =====================================================

# ëª¨ì˜íˆ¬ìì—ì„œ ì‚¬ìš©í•  ê°€ì§œ ì˜ˆìˆ˜ê¸ˆ
PAPER_FAKE_CASH = 3_000_000  # 300ë§Œì›



# =====================================================
# ğŸ§ª ê¸°ì¡´ ì½”ë“œ í˜¸í™˜ìš© alias
# (â— íŒë‹¨ ê¸°ì¤€ì€ is_paper_trading í•˜ë‚˜ë§Œ)
# =====================================================
FAKE_MODE   = is_paper_trading
TEST_MODE   = is_paper_trading
PAPER_CASH  = PAPER_FAKE_CASH
FAKE_CASH   = PAPER_FAKE_CASH

# =====================================================
# ğŸ’° ì „ëµ ìê¸ˆ ì œí•œ
# =====================================================
STRATEGY_MAX_CASH = PAPER_FAKE_CASH

# =====================================================
# ğŸ”§ ê¸°íƒ€
# =====================================================
DEBUG_MODE = True


# =====================================================
# ğŸ•’ ë§¤ìˆ˜ ì‹œê°„ í•„í„° (ì „ëµ í™˜ê²½ ì¡°ê±´)
# =====================================================
# ì¥ ì´ˆë°˜ / ë§ˆê° ì§ì „ ì œì™¸
BUY_START_TIME = "0930"
BUY_END_TIME = "1430"


# =====================================================
# ğŸ“ˆ ë§¤ìˆ˜ ì „ëµ ê´€ë ¨ íŒŒë¼ë¯¸í„°
# =====================================================
# ê±°ë˜ëŸ‰ ê¸°ì¤€ë´‰ ë°°ìˆ˜ (í‰ê·  ê±°ë˜ëŸ‰ ëŒ€ë¹„)
ANCHOR_VOLUME_MULT = 5


# =====================================================
# ğŸ›‘ ì†ì ˆ ì „ëµ (Fail Fast)
# =====================================================
# ë°•ìŠ¤ ë†’ì´ ëŒ€ë¹„ ì†ì ˆ buffer ë¹„ìœ¨
# ì†ì ˆê°€ = box_low - (box_height * ratio)
STOPLOSS_BOX_BUFFER_RATIO = 0.20


# =====================================================
# ğŸŸ¦ íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘ ì „ëµ
# =====================================================
# íŠ¸ë ˆì¼ë§ í™œì„±í™” ì¡°ê±´ A: ìˆ˜ìµë¥  ê¸°ì¤€
TRAIL_ACTIVATE_PROFIT_PCT = 0.015  # +1.5%

# íŠ¸ë ˆì¼ë§ í™œì„±í™” ì¡°ê±´ B: ë°•ìŠ¤ ìƒë‹¨ ìœ„ ìœ ì§€ ë´‰ ìˆ˜
TRAIL_ACTIVATE_HOLD_BARS = 3

# íŠ¸ë ˆì¼ë§ ê°€ê²© ê³„ì‚° ê¸°ì¤€ ë´‰ ìˆ˜
TRAIL_N_BARS = 3


# =====================================================
# ğŸ“‰ ë¦¬ìŠ¤í¬ ê´€ë¦¬ (ê³„ì¢Œ ë‹¨ìœ„)
# =====================================================
# ì¼ì¤‘ ìµœëŒ€ ì†ì‹¤ë¥  (MDD)
# ì˜ˆ: -10% ë„ë‹¬ ì‹œ ìë™ ì¤‘ë‹¨
MAX_DAILY_MDD_PCT = -0.10


# =====================================================
# â± ì¬ì§„ì… ì œì–´
# =====================================================
# ì†ì ˆ í›„ ì¬ì§„ì… ì¿¨íƒ€ì„ (ë¶„)
STOPLOSS_COOLDOWN_MIN = 30

# =====================================================
# ğŸ” ì¡°ê±´ê²€ìƒ‰ ê´€ë¦¬
# =====================================================
# ì¡°ê±´ê²€ìƒ‰ìœ¼ë¡œ ë™ì‹œì— ì¶”ì í•  ìµœëŒ€ ì¢…ëª© ìˆ˜
MAX_CONDITION_STOCKS = 20  # 10 ~20 : ì•ˆì •ì , 30 ì´ìƒ : ê´€ë¦¬ë¶€ë‹´ì¦ê°€

# =====================================================
# â³ ì¡°ê±´ê²€ìƒ‰ â†’ ë§¤ìˆ˜ ëŒ€ê¸° ì œí•œ
# =====================================================
# ì¡°ê±´ê²€ìƒ‰ í¬ì°© í›„ ìµœëŒ€ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)
# ì´ ì‹œê°„ ì´ˆê³¼ ì‹œ ë§¤ìˆ˜ ì‹œë„ ì—†ì´ í›„ë³´ì—ì„œ ì œê±°
MAX_WAIT_BEFORE_BUY_SEC = 300  # 300 (5ë¶„), 180(3ë¶„):ì•„ì£¼íƒ€ì´íŠ¸, 600(10ë¶„):ëŠìŠ¨


# =====================================================
# ğŸ“Š ë¦¬í¬íŠ¸ / ë¡œê·¸
# =====================================================
# ì¼ì¼ ì†ìµ ë¡œê·¸ íŒŒì¼
DAILY_PNL_LOG_PATH = "./logs/daily_pnl.csv"

# ì›”ê°„/ì£¼ê°„ ìš”ì•½ ì €ì¥ ê²½ë¡œ
SUMMARY_REPORT_PATH = "./reports/"


# =====================================================
# ğŸ“© í…”ë ˆê·¸ë¨
# =====================================================
telegram_chat_id = "8254571263"
telegram_token = "7995086247:AAGIueTwRd_aHFZiodWoEqK2luGq4OcA034"

# í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­
TELEGRAM_BOT_TOKEN = telegram_token
TELEGRAM_CHAT_ID = telegram_chat_id

# =====================================================
# ğŸ“¢ í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì„¤ì •
# =====================================================
# ê°œë³„ ë§¤ë§¤ ìƒí™© ì•Œë¦¼ on/off
# True: ë§¤ìˆ˜/ë§¤ë„ ì‹œë„/ì„±ê³µ/ì‹¤íŒ¨ ì•Œë¦¼ ì „ì†¡
# False: ê°œë³„ ë§¤ë§¤ ìƒí™© ì•Œë¦¼ ë¹„í™œì„±í™” (ì‹œìŠ¤í…œ/Watchlist ì•Œë¦¼ì€ ìœ ì§€)
ENABLE_TRADE_NOTIFICATIONS = False  # ê¸°ë³¸ê°’: off

# ======================================================
# ğŸ’³ ê³„ì¢Œ ì •ë³´
# ======================================================
# ëª¨ì˜íˆ¬ì / ì‹¤ì „ ê³µí†µ (í˜•ì‹: "12345678-01")
account_no = "00000000-01"  # â† ì§€ê¸ˆì€ ë”ë¯¸ê°’ (ëª¨ì˜íˆ¬ììš©)
account_product = "01"  # ê³„ì¢Œ ìƒí’ˆ ì½”ë“œ (ë³´í†µ "01")

# ======================================================
# ğŸ§¾ TR ID (ì£¼ë¬¸ìš©)
# ======================================================
# ëª¨ì˜íˆ¬ì / ì‹¤ì „ ì£¼ë¬¸ TR ID
BUY_TR_ID = "VTTC0802U" if is_paper_trading else "TTTC0802U"
SELL_TR_ID = "VTTC0801U" if is_paper_trading else "TTTC0801U"

# risk_manager í˜¸í™˜ìš© ë³„ì¹­
MAX_MDD_PCT = MAX_DAILY_MDD_PCT

# =====================================================
# ğŸ›‘ ìë™ë§¤ë§¤ ì¤‘ë‹¨(HALT) í”Œë˜ê·¸ íŒŒì¼
# =====================================================
HALT_FLAG_FILE = "./halt.flag"

# =====================================================
# ğŸ›‘ TEST_MODE : ì¥ì‹œê°„ ë¬´ì‹œ, ë§¤ìˆ˜ ì¡°ê±´ ì™„í™”ì˜µì…˜
# =====================================================

TEST_MODE = True  # Falseë©´ ì‹¤ì „

BUY_START_TIME = "0930"
BUY_END_TIME = "1430"

MIN_SIGNAL_COUNT_TEST = 1
MIN_SIGNAL_COUNT_REAL = 2


# =====================================================
# ğŸ“ˆ ë§¤ìˆ˜ ê°€ê²© ì „ëµ (ì•ì—ì„œë¶€í„° ìˆœì„œëŒ€ë¡œ ì‹œë„)
# ê¸°ë³¸ê°’ì€ ê¸°ì¡´ ë™ì‘ê³¼ ë™ì¼
# =====================================================

BUY_PRICE_STRATEGY = [
    "MARKET",  # ì‹œì¥ê°€
    "ASK+1",  # ë§¤ë„í˜¸ê°€ 1í˜¸ê°€
    # "ASK+2",  # â† ì›”ìš”ì¼ ì´í›„ì— ì¼œë©´ ë¨
]

# =====================================================
# ğŸ“‰ ë§¤ë„ ê°€ê²© ì „ëµ (ì•ì—ì„œë¶€í„° ìˆœì„œëŒ€ë¡œ ì‹œë„)
# ê¸°ë³¸ê°’ì€ ê¸°ì¡´ ë™ì‘ê³¼ ë™ì¼
# =====================================================

SELL_PRICE_STRATEGY = [
    "MARKET",  # ì‹œì¥ê°€
    "BID-1",  # ë§¤ìˆ˜í˜¸ê°€ 1í˜¸ê°€
    # "BID-2",  # â† ì›”ìš”ì¼ ì´í›„ì— ì¼œë©´ ë¨
]

# =====================================================
# ğŸ” ì£¼ë¬¸ ì‹¤íŒ¨ ì¬ì‹œë„ ì„¤ì •
# =====================================================

ORDER_RETRY_ENABLED = False  # falseëŠ” ë¹„í™œì„±, ì‹¤ì „ì‹œ trueë¡œ ë³€ê²½
ORDER_RETRY_COUNT = 2  # ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜
ORDER_RETRY_DELAY_SEC = 1  # ì¬ì‹œë„ ê°„ ëŒ€ê¸° (ì´ˆ)


# =====================================================
# ğŸ’° ì „ëµìš© ìê¸ˆ ì œí•œ (ëª¨ì˜/ì‹¤ì „ ê³µí†µ)
# =====================================================
STRATEGY_MAX_CASH = 3_000_000  # ì‹¤ì „ ê¸°ì¤€ 300ë§Œì›


# =====================================================
# ğŸ’“ í…”ë ˆê·¸ë¨ í•˜íŠ¸ë¹„íŠ¸ ì„¤ì •
# =====================================================
HEARTBEAT_INTERVAL_MIN = 30  # ëª‡ ë¶„ë§ˆë‹¤ ìƒì¡´ ì•Œë¦¼ ë³´ë‚¼ì§€ (30ë¶„)


# ======================================================
# ğŸ’³ ê³„ì¢Œ ì •ë³´ (ê³µí†µ í‘œì¤€ ì´ë¦„)
# ======================================================
ACCOUNT_NO = account_no.replace("-", "")




def get_available_cash(real_cash: int | None = None) -> int:
    """
    ì‹¤ì „/ëª¨ì˜ì— ë”°ë¼ ì‚¬ìš©í•  ì˜ˆìˆ˜ê¸ˆ ë°˜í™˜
    - ì‹¤ì „: balance API ê²°ê³¼ ì‚¬ìš©
    - ëª¨ì˜: ê³ ì • ê°€ì§œ ì˜ˆìˆ˜ê¸ˆ ì‚¬ìš©
    """
    if is_paper_trading:
        return PAPER_FAKE_CASH

    if real_cash is None:
        raise ValueError("ì‹¤ì „ ê±°ë˜ì¸ë° real_cashê°€ Noneì…ë‹ˆë‹¤")

    return real_cash

# TEST/config_test.py

ENV_NAME = "TEST"   # ë‹¨ìˆœíˆ ê°€ìƒí™˜ê²½ì´ë¦„ ì§€ì •í•´ë‘”ê±°


# ==================================================
# ğŸ§ª TEST ì „ìš© ì˜µì…˜
# ==================================================
FORCE_FAKE_SELL = True

# ë””ë²„ê·¸ì—ì„œ í™œìš©
DEBUG = True
